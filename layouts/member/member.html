{{- define "main" -}}

{{/* Initialise */}}
{{ $ := . }}
{{ $page := . }}
  
<div class="container">
    {{ range $page.Params.content.user_groups }}
        {{ $query := where (where site.Pages "Section" "authors") ".Params.user_groups" "intersect" (slice .) }}
        {{if $query}}
            <div style="display: flex; flex-direction: column; justify-content: center;">
                <div style="margin:0 auto;">
                    <h1>{{ . | markdownify }}</h1>
                    <hr style="background-color: #2962ff;"/>
                </div>
            </div>
            
            {{ range $query }}
                {{ $avatar := (.Resources.ByType "image").GetMatch "*avatar*" }}
                {{/* Get link to user's profile page. */}}
                {{ $link := "" }}
                {{ with site.GetPage (printf "/authors/%s" (path.Base (path.Split .Path).Dir)) }}
                    {{ $link = .Params.website_url }}
                {{ end }}
                <div class="row">
                    <div class="col12 col-lg-4">
                        <div id="profile">
                            {{ $src := "" }}
                            {{ if site.Params.gravatar }}
                                {{ $src = printf "https://s.gravatar.com/avatar/%s?s=200" (md5 .Params.email) }}
                            {{ else if $avatar }}
                                {{ $avatar_image := $avatar.Fill "150x150 Center" }}
                                {{ $src = $avatar_image.RelPermalink }}
                            {{ end }}
                            {{ if $src }}
                                {{with $link}}
                                    <a href="{{.}}">{{end}}<img class="portrait" src="{{ $src }}" alt="Avatar">{{if $link}}</a>
                                {{end}}
                            {{ end }}
                
                            <div class="portrait-title">
                                <h2>{{with $link}}<a href="{{.}}">{{end}}{{ .Params.name }}{{if $link}}</a>{{end}}</h2>
                                {{ with .Params.role }}<h3>{{ . | markdownify | emojify }}</h3>{{ end }}
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center;" class="col-12 col-lg-8">
                        <p>{{ .Content }}</p>
                    </div>
                </div>
            {{ end }}
        {{ end }}
    {{ end }}
</div>

{{- end -}}